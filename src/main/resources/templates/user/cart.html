<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base::layout(~{::section})}">
<head>
    <!-- Esto se borrará al renderizar, por eso movemos el CSS abajo -->
</head>
<body>
	<section class="cart-page">
		<!-- CSS INTERNO: Esto SÍ se procesará porque está dentro de <section> -->
		<style>
			.product-img-cart {
				width: 80px !important;
				height: 80px !important;
				object-fit: cover !important;
				border-radius: 10px;
				border: 1px solid #ddd;
				display: block;
			}
			.card-sh {
				border: none;
				box-shadow: 0 10px 30px rgba(0,0,0,0.08);
				border-radius: 15px;
			}
			.table > tbody > tr > td {
				vertical-align: middle !important;
			}
			.quantity-control {
				display: inline-flex;
				align-items: center;
				background: #f8f9fa;
				border-radius: 50px;
				padding: 5px 15px;
				border: 1px solid #eee;
			}
			.quantity-btn {
				color: #333;
				text-decoration: none;
				font-weight: bold;
				padding: 0 10px;
			}
			.quantity-btn:hover { color: #0d6efd; }
		</style>

		<div class="container-fluid mt-5 p-5">
			<div class="card card-sh">
				<div class="card-header bg-white text-center py-4">
					<p class="fs-3 fw-bold mb-0">Tu Carrito de Compras</p>
					
					<div th:if="${session.succMsg}" class="alert alert-success mt-3">
						[[${session.succMsg}]]
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>

					<div th:if="${session.errorMsg}" class="alert alert-danger mt-3">
						[[${session.errorMsg}]]
						<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
					</div>
				</div>
				
				<div class="card-body p-4">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead class="table-light">
								<tr>
									<th scope="col" class="py-3">Nº</th>
									<th scope="col" class="py-3">Imagen</th>
									<th scope="col" class="py-3">Producto</th>
									<th scope="col" class="py-3">Precio</th>
									<th scope="col" class="py-3 text-center">Cantidad</th>
									<th scope="col" class="py-3">Total</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="cart,c:${carts}">
									<th scope="row">[[${c.count}]]</th>
									<td>
										<!-- Inline style para asegurar el tamaño pase lo que pase -->
										<img th:src="@{'/img/product_img/'+${cart.product.image}}"
											 class="product-img-cart"
											 style="width:80px; height:80px; object-fit:cover;">
									</td>
									<td class="fw-semibold">[[${cart.product.title}]]</td>
									<td>$[[${cart.product.discountPrice}]]</td>
									<td class="text-center">
										<div class="quantity-control">
											<a th:href="@{'/user/cartQuantityUpdate?sy=de&cid='+${cart.id}}" 
											   class="quantity-btn text-danger">
												<i class="fa-solid fa-minus"></i>
											</a>
											<span class="mx-2 fw-bold">[[${cart.quantity}]]</span>
											<a th:href="@{'/user/cartQuantityUpdate?sy=in&cid='+${cart.id}}" 
											   class="quantity-btn text-success">
												<i class="fa-solid fa-plus"></i>
											</a>
										</div>
									</td>
									<td class="fw-bold text-primary">$[[${cart.totalPrice}]]</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- Resumen de Pago -->
					<div class="d-flex justify-content-end mt-4">
						<div class="col-md-4">
							<ul class="list-group list-group-flush">
								<li class="list-group-item d-flex justify-content-between align-items-center border-0">
									<span class="fs-5 fw-bold">Total Final:</span>
									<span class="fs-4 fw-bold text-success">
										<th:block th:utext="${@commnServiceImpl.currencySign()}"></th:block> 
										[[${totalOrderPrice}]]
									</span>
								</li>
							</ul>
							<div class="text-center mt-3">
								<a href="/user/orders" class="btn btn-primary btn-lg w-100 shadow-sm">
									Proceder con el pago <i class="fa-solid fa-chevron-right ms-2"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</body>
</html>
